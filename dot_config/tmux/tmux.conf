# ============================================
# BASIC SETTINGS
# ============================================
# Use zsh. Duh.
set-option -g default-shell /bin/zsh

# Enable mouse support
set -g mouse on

# Set scrollback buffer size
set -g history-limit 10000

# ============================================
# KEYBINDINGS
# ============================================

# Reload config with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# More intuitive split commands
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Easy pane navigation (Alt + arrow keys, no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Window switching with Shift + arrow
bind -n S-Left previous-window
bind -n S-Right next-window

# Vim-style pane selection
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ============================================
# QUALITY OF LIFE
# ============================================

# Don't rename windows automatically
set-option -g allow-rename off

# Set vi mode for copy mode
setw -g mode-keys vi

# Better copy mode bindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# Keep current directory when creating new windows/panes
bind c new-window -c "#{pane_current_path}"

# ============================================
# CUSTOM POWERLINE-STYLE STATUS BAR
# ============================================

# Status update interval
set -g status-interval 1

# Status bar colors
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'
set -g status-position bottom

# Left side: Session & Git info
set -g status-left-length 100
set -g status-left '#[fg=#1e1e2e,bg=#89b4fa,bold] #S #[fg=#89b4fa,bg=#45475a,nobold]#[fg=#cdd6f4,bg=#45475a] #(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD 2> /dev/null || echo "â€”") #[fg=#45475a,bg=#1e1e2e]'

# Window tabs in center
set -g status-justify centre
setw -g window-status-format '#[fg=#1e1e2e,bg=#313244]#[fg=#cdd6f4,bg=#313244] #I #W #[fg=#313244,bg=#1e1e2e]'
setw -g window-status-current-format '#[fg=#1e1e2e,bg=#f9e2af]#[fg=#1e1e2e,bg=#f9e2af,bold] #I #W #[fg=#f9e2af,bg=#1e1e2e]'

# Right side: System info
set -g status-right-length 100
set -g status-right '#[fg=#45475a]#[fg=#cdd6f4,bg=#45475a] %H:%M #[fg=#89b4fa,bg=#45475a]#[fg=#1e1e2e,bg=#89b4fa,bold] #H '

# Automatic rename with dir/command
set -g automatic-rename on
set -g automatic-rename-format '#{=12:#{b:pane_current_path}}/#{=10:pane_current_command}'

# Window status with smart truncation
setw -g window-status-format '#I:#{=10:#{b:pane_current_path}}/#{=6:pane_current_command}#F'
setw -g window-status-current-format '#[bold]#I:#{=12:#{b:pane_current_path}}/#{=8:pane_current_command}#F'

# Don't let programs override
set -g allow-rename off

# ============================================
# PLUGINS (requires TPM)
# ============================================

# Auto-install TPM if not present (add before the plugin list)
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "~/.config/tmux/plugins/tpm/bin/install_plugins'"

set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'  # Save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'  # Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-yank'       # Better copy/paste

# Plugin settings
set -g @resurrect-strategy-vim 'session'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TPM (keep this at the very bottom)
run '~/.config/tmux/plugins/tpm/tpm'